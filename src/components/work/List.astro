---
const redisURL = import.meta.env.PUBLIC_UPSTASH_REDIS_REST_URL;
const redisToken = import.meta.env.PUBLIC_UPSTASH_REDIS_REST_TOKEN;
const token = `Bearer ${redisToken}`;

const allRepos = await fetch(
  `${redisURL}/mget/001_archive/002_style/003_utility/004_js_and_ts/005_rust/ghmetrics`,
  {
    headers: { Authorization: token }
  }
)
  .then((response) => response.json())
  .then((data) => {
    const result = data.result;
    const repos = result.map((repo) => JSON.parse(repo));
    return repos;
  });
---

<ul>
  {
    allRepos.map((repo) => (
      <li>
        <header>
          <small>
            {repo.description != `n/a`
              ? repo.description
                  .split(`:`)
                  .map((item) => item)
                  .slice(0, -1)
              : `project`}
          </small>
          <h3>{repo.name.split(`_`).join(` `)}</h3>
        </header>
        <p class='text_small'>
          {repo.description
            .split(`:`)
            .map((item) => item)
            .slice(1)}
        </p>
      </li>
    ))
  }
</ul>

<style lang='scss'>
  ul {
    & li {
      max-width: 37.5rem;
      padding: 0.65rem 0;

      & header {
        & small {
          color: var(--secondary-accent);

          font-weight: 400;

          text-transform: uppercase;
        }
      }

      &:hover {
        background-color: hsla(0, 60%, 99%, 0.01);
        backdrop-filter: blur(1px);

        cursor: pointer;
      }
    }
    @media (min-width: 31.25rem) {
      & li {
        padding: 0.65rem 0.5rem;
      }
    }
  }
</style>
